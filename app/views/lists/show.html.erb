
<div class="list_container">
  <div class="basile">
    <h2 id="events-title" class="view"><%= link_to @list.event.name.upcase, event_path(@list.event) %></h2>
    <%= cl_image_tag @list.user.photo.key, class: "avatar-small mr-3" %>
  </div>
    <ul class="list-card">
      <% @list.ideas.each do |idea| %>
        <div class="card-idea d-flex flex-column">
          <div class="d-flex justify-content-between mb-4">

            <div class="d-flex">
              <%= cl_image_tag idea.photo.key, class: 'idea-img mr-4' if idea.photo %>
              <div class= "card-idea-bloc">
                <div class = "idea-title">
                  <%= idea.title.upcase %>
                </div>
                <div class = "idea-description"><%= idea.description.upcase %></div>
                <a href="<%= idea.url %>" target="_blank" class= "lien">Voir plus</a>
              </div>
            </div>

            <div class="d-flex align-items-center idea-buttons mb-4">


              <% if @list.user.id == current_user.id %>
                <%= link_to '#' do %>
                  <%= image_tag 'picto_modifier.png', width: 40 %>
                <% end %>
                <%= link_to '#' do %>
                  <%= image_tag 'picto_corbeille.png', width: 20 %>
                <% end  %>
              <% end %>


              <% is_me = @list.user == current_user %>

              <div id="idea-<%=idea.id%>">
                <%= render 'idea_modal', idea: idea, is_me: is_me %>
              </div>

            </div>
          </div>

          <div class="mb-5">
            <% if @list.user != current_user %>


              <details>
                <summary class="titre-commentaires"> Commentaires </summary>
                <div class="comments" >
                    <ul id="idea_<%= idea.id %>">
                      <% idea.comments.each do |comment|  %>
                        <%= render "lists/comment_li", comment: comment %>
                      <% end %>
                    </ul>
                </div>

                <div id= "form_idea_<%= idea.id%>">
                  <%= render "lists/comment_form", idea: idea %>
                </div>
              </details>

            <% end %>
          </div>

        </div>


      <% end %>

      <% if @list.user == current_user %>
      <!-- modal add idea -->
      <div class="grow-card btn-center" type="" data-toggle="modal" data-target='#<%= "staticBackdrop#{@list.id}" %>' style="display: flex; align-items: center; justify-content: center;">
        <%= image_tag 'picto_add.png', width: 60, class: "picto-add" %>
      </div>

<div class= "mt-3">
   <%= simple_form_for @list.event, url: invite_users_event_path(@list.event), method: :post  do |f| %>
    <%= f.input :emails, collection: [], input_html: { class: "js-example-basic-multiple", name: "emails[]", multiple: "multiple"}, label: "Invite ta MIF à l'événement !" %>
    <%= f.submit "Envoyer", class: "btn btn-primary btn-bleu" %>
   <% end %>

</div>
      <% end %>

    </ul>

</div>

<!-- modal idea -->
  <%= render 'lists/modal_white', list: @list %>


  <% content_for :after_js do %>
    <script>

      scrollLastMessageIntoView();
      App['list_<%= @list.id %>'] = App.cable.subscriptions.create({ channel: 'ListsChannel', list_id: <%= @list.id %>}, {
        received: (data) => {
          console.log(data);
          const ideaComment = document.getElementById(`idea_${data.idea_id}`);
          ideaComment.insertAdjacentHTML("beforeend", data.comment_partial);
          scrollLastMessageIntoView();
        }
      })
    </script>
  <% end %>




